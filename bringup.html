<html>
<head>
<script src="piano.js"></script>
</head>

<script type="text/javascript">
    
document.addEventListener("DOMContentLoaded", function() {
    var instrument = new Piano.Instrument();

    instrument.loadAudioFile("piano.mp3", function(err) {
        console.log(instrument._buffer);
    });

    var offsets = {
        36: 0.7,
        39: 2.4,
        42: 4.1,
        45: 5.8,
        48: 7.5,
        51: 9.2,
        54: 10.8,
        57: 12.4,
        60: 14.0,
        63: 15.6,
        66: 17.2,
        69: 18.8,
        72: 20.4,
        75: 21.6,
        78: 22.3,
        81: 22.8,
        84: 23.3
    }


    var durations = {
        36: 1.5,   39: 1.5,   42: 1.5,   45: 1.5,
        48: 1.5,   51: 1.4,   54: 1.4,   57: 1.4,
        60: 1.4,   63: 1.4,   66: 1.4,   69: 1.4,
        72: 1.0,   75: 0.4,   78: 0.25,  81: 0.3,
        84: 0.2,   87: 0.2 
    }

    var loopCounts = {
        36: 2697,   39: 1134,   42: 3099,   45: 2205,
        48: 2697,   51: 1134,   54: 2503,   57: 2205,
        60: 2697,   63: 2197,   66: 2503,   69: 2205,
        72: 2402,   75: 2197,   78: 2652,   81: 2205,
        84: 2402,   87: 2073        
    }

    for (var key in offsets) { if (offsets.hasOwnProperty(key)) {
        var zone = new Piano.Zone();

        zone.key = parseInt(key, 10);
        zone.offset = offsets[key];
        zone.keyRangeStart = parseInt(key, 10);
        zone.keyRangeEnd   = parseInt(key, 10);
        zone.loopStart = durations[key] * 22050;
        zone.loopEnd   = zone.loopStart + loopCounts[key];
        zone.loops     = true;

        zone.decay = [ 6, 0.01, 1, 0.000001 ];

        instrument.zones.push(zone);
    }}

    var zone = new Piano.Zone();

    zone.offset   = 0.2;
    zone.duration = 0.4;

    zone.keyRangeStart = 0;
    zone.keyRangeEnd   = 127;
    zone.gain = 0.15;

    instrument.zones.push(zone);


    setTimeout(function() {
        instrument.start(60);

        setTimeout(function() {
            instrument.stop();
        }, 2000);
    }, 500);


}, false);


</script>



<body>

</body>
</html>